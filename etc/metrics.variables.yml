grafana_datasources:
    apiVersion: 1
    datasources:
        - name: "Flux (InfluxDB) [BETA]"
          type: grafana-influxdb-flux-datasource
          access: proxy
          orgId: 1
          url: http://{{ influxdb_ipaddr }}:{{ influxdb_conf.bind.port }}
          database: 
          isDefault: true
          version: 1
          editable: false
          jsonData:
              bucket: "{{ influxdb_bucket }}"
              organization: "{{ influxdb_org }}"
              url: "http://{{ influxdb_ipaddr }}:{{ influxdb_conf.bind.port }}"
          secureJsonData:
              token: "{{ grafana_influxdb_token }}"

grafana_plugins:
    - name: flux
      url: https://github.com/grafana/influxdb-flux-datasource/releases/download/v5.4.1/grafana-influxdb-flux-datasource-5.4.1.zip

traefik_conf:
    entryPoints:
        web:
            address: ":8080"

        websecure:
            address: ":8443"
    http:
        routers:
            grafana:
                service: grafana
                rule: "PathPrefix(`/grafana`)"
                entryPoints:
                    - web
            influxdb:
                service: influxdb
                rule: "PathPrefix(`/`)"
                entryPoints:
                    - web
        services:
            grafana:
                loadBalancer:
                    servers:
                        - url: http://{{ grafana_ipaddr }}:3000/grafana
            influxdb:
                loadBalancer:
                    servers:
                        - url: http://{{ influxdb_ipaddr }}:{{ influxdb_conf.bind.port }}/

influxdb_conf:
    bind:
        port: 8086
    buckets:
        - haproxy
        - traefik
        - postgresql
        - apache-php
        - nginx
        - mongodb
