grafana_datasources:
    apiVersion: 1
    datasources:
        - name: "{{ lookup('env', 'OS_PROJECT_NAME') }}"
          type: influxdb
          access: proxy
          orgId: 1
          url: http://{{ influxdb_ipaddr }}:{{ influxdb_conf.bind.port }}
          database: "default"
          isDefault: true
          version: 1
          editable: false

traefik_conf:
    entryPoints:
        web:
            address: ":8080"

        websecure:
            address: ":8443"
    http:
        routers:
            grafana:
                service: grafana
                rule: "Host('{{ lookup('env', 'METRICS_ENDPOINT_URL') | urlsplit('hostname') }}') && Path('/grafana')"
            influxdb:
                service: influxdb
                rule: "Host('{{ lookup('env', 'METRICS_ENDPOINT_URL') | urlsplit('hostname') }}') && Path('/influxdb')"
        services:
            grafana:
                loadBalancer:
                    servers:
                        - url: http://{{ grafana_ipaddr }}:3000/
            influxdb:
                loadBalancer:
                    servers:
                        - url: http://{{ influxdb_ipaddr }}:{{ influxdb_conf.bind.port }}/

influxdb_conf:
    bind:
        port: 8086

